#include <p24fj32GA004.h>
#define FCY  16000000	//define instruction frequency here in Hz
#include <libpic30.h>	//Ultility library for pic24.
#include "GLCD_24.h"

//Define control pins here.
#define CHIPSELECT PORTBbits.RB9
#define RES PORTBbits.RB10
#define DATAMODE PORTBbits.RB11   //Register select pin, which is A0 on datasheet.

//Define pin direction.
#define TCHIPSELECT TRISBbits.TRISB9
#define TRES TRISBbits.TRISB10
#define TDATAMODE TRISBbits.TRISB11
#define SET_COLUMN_HIGH 0b00010000
#define SET_COLUMN_LOW 0b00000000
#define SET_PAGE 0b10110000

/*
//Just some symbols.
#define ARROW_RIGHT 0
#define ARROW_RIGHT_FILLED 1
#define ARROW_LEFT 2
#define ARROW_LEFT_FILLED 3
#define FILL 4
*/

//Variable for the current position of the cursor in a 4*16 coordinate system, left-upper corner represents x=0,y=0.

unsigned char X = 0;
unsigned char Y = 0;


const unsigned char SYMBOLS[] = {
 0xFE, 0xFF, 0x04, 0x40, 0x08, 0x20, 0x10, 0x10, 0x20, 0x08, 0x40, 0x04, 0x80, 0x02, 0x00, 0x01,  // Code for char  
 0xFE, 0xFF, 0xFC, 0x7F, 0xF8, 0x3F, 0xF0, 0x1F, 0xE0, 0x0F, 0xC0, 0x07, 0x80, 0x03, 0x00, 0x01,  // Code for char 
 0x00, 0x01, 0x80, 0x02, 0x40, 0x04, 0x20, 0x08, 0x10, 0x10, 0x08, 0x20, 0x04, 0x40, 0xFE, 0xFF,  // Code for char 
 0x00, 0x01, 0x80, 0x03, 0xC0, 0x07, 0xE0, 0x0F, 0xF0, 0x1F, 0xF8, 0x3F, 0xFC, 0x7F, 0xFE, 0xFF,  // Code for char 
 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,  0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF  // Code for char 
        };


const unsigned char CHAR_TABLE[] = {
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  // Code for char  
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFC, 0x37, 0xFC, 0x31, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  // Code for char !
         0x00, 0x00, 0x00, 0x00, 0x38, 0x00, 0x08, 0x00, 0x08, 0x00, 0x38, 0x00, 0x00, 0x00, 0x00, 0x00,  // Code for char "
         0x40, 0x04, 0x40, 0x3C, 0xF8, 0x07, 0x40, 0x04, 0x40, 0x34, 0xF0, 0x0F, 0x48, 0x04, 0x40, 0x04,  // Code for char #
         0x00, 0x00, 0x70, 0x1C, 0xD8, 0x30, 0xFC, 0x7F, 0x08, 0x21, 0x38, 0x1F, 0x20, 0x0E, 0x00, 0x00,  // Code for char $
         0x70, 0x00, 0x88, 0x30, 0xF8, 0x0C, 0x40, 0x03, 0xE0, 0x1E, 0x18, 0x21, 0x00, 0x3F, 0x00, 0x00,  // Code for char %
         0x00, 0x0C, 0x00, 0x1F, 0xF8, 0x31, 0x88, 0x23, 0x78, 0x34, 0x30, 0x18, 0x00, 0x1E, 0x00, 0x10,  // Code for char &
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x38, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  // Code for char '
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF0, 0x0F, 0x18, 0x30, 0x04, 0x40, 0x00, 0x00,  // Code for char (
         0x00, 0x40, 0x04, 0x60, 0x18, 0x30, 0xE0, 0x0F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  // Code for char )
         0x00, 0x00, 0x20, 0x01, 0xA0, 0x00, 0xF8, 0x07, 0xF8, 0x07, 0xA0, 0x00, 0x20, 0x01, 0x00, 0x00,  // Code for char *
         0x00, 0x01, 0x00, 0x01, 0x00, 0x01, 0xE0, 0x0F, 0x00, 0x01, 0x00, 0x01, 0x00, 0x01, 0x00, 0x01,  // Code for char +
         0x00, 0x00, 0x00, 0xB0, 0x00, 0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  // Code for char ,
         0x00, 0x01, 0x00, 0x01, 0x00, 0x01, 0x00, 0x01, 0x00, 0x01, 0x00, 0x01, 0x00, 0x01, 0x00, 0x00,  // Code for char -
         0x00, 0x00, 0x00, 0x30, 0x00, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  // Code for char .
         0x00, 0x20, 0x00, 0x10, 0x00, 0x0C, 0x00, 0x03, 0xC0, 0x00, 0x30, 0x00, 0x08, 0x00, 0x00, 0x00,  // Code for char /
         0x00, 0x00, 0xF0, 0x0F, 0x18, 0x10, 0x08, 0x20, 0x08, 0x30, 0x18, 0x18, 0xE0, 0x0F, 0x00, 0x00,  // Code for char 0
         0x00, 0x00, 0x60, 0x00, 0x20, 0x00, 0xF0, 0x3F, 0xF8, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  // Code for char 1
         0x00, 0x00, 0x30, 0x30, 0x18, 0x38, 0x08, 0x34, 0x08, 0x33, 0xD8, 0x31, 0x70, 0x30, 0x00, 0x00,  // Code for char 2
         0x00, 0x00, 0x30, 0x18, 0x18, 0x10, 0x08, 0x20, 0x88, 0x21, 0xD8, 0x13, 0x70, 0x0E, 0x00, 0x00,  // Code for char 3
         0x00, 0x04, 0x00, 0x07, 0x80, 0x05, 0x60, 0x04, 0x30, 0x04, 0xF8, 0x3F, 0x00, 0x04, 0x00, 0x04,  // Code for char 4
         0x00, 0x08, 0xF0, 0x19, 0x98, 0x30, 0xC8, 0x20, 0x88, 0x30, 0x88, 0x19, 0x08, 0x0F, 0x00, 0x00,  // Code for char 5
         0x00, 0x00, 0x80, 0x1F, 0xC0, 0x31, 0xF0, 0x20, 0x98, 0x20, 0x80, 0x30, 0x00, 0x1F, 0x00, 0x06,  // Code for char 6
         0x00, 0x00, 0x08, 0x00, 0x08, 0x30, 0x08, 0x3E, 0x88, 0x03, 0xE8, 0x00, 0x38, 0x00, 0x00, 0x00,  // Code for char 7
         0x00, 0x04, 0xF0, 0x1F, 0x88, 0x31, 0x88, 0x21, 0x88, 0x21, 0xD8, 0x31, 0x70, 0x1E, 0x00, 0x00,  // Code for char 8
         0xE0, 0x00, 0xF0, 0x01, 0x08, 0x23, 0x08, 0x3A, 0x08, 0x0F, 0x98, 0x03, 0xF0, 0x00, 0x00, 0x00,  // Code for char 9
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x31, 0x00, 0x11, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  // Code for char :
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xF1, 0x00, 0x31, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  // Code for char ;
         0x00, 0x00, 0x80, 0x01, 0x80, 0x02, 0x40, 0x04, 0x20, 0x08, 0x10, 0x10, 0x08, 0x20, 0x00, 0x00,  // Code for char <
         0x40, 0x04, 0x40, 0x04, 0x40, 0x04, 0x40, 0x04, 0x40, 0x04, 0x40, 0x04, 0x40, 0x04, 0x00, 0x00,  // Code for char =
         0x00, 0x00, 0x08, 0x30, 0x10, 0x10, 0x20, 0x08, 0x40, 0x04, 0x80, 0x02, 0x00, 0x01, 0x00, 0x00,  // Code for char >
         0x00, 0x00, 0x30, 0x00, 0x18, 0x00, 0x08, 0x32, 0x88, 0x11, 0xF8, 0x00, 0x70, 0x00, 0x00, 0x00,  // Code for char ?
         0xE0, 0x0F, 0x10, 0x10, 0x88, 0x27, 0x68, 0x28, 0x28, 0x27, 0xE8, 0x28, 0xF0, 0x07, 0x00, 0x00,  // Code for char @
         0x00, 0x20, 0x00, 0x3E, 0xC0, 0x07, 0x78, 0x02, 0x78, 0x02, 0xC0, 0x07, 0x00, 0x3C, 0x00, 0x20,  // Code for char A
         0x00, 0x00, 0xF8, 0x3F, 0x88, 0x31, 0x88, 0x31, 0x88, 0x31, 0x98, 0x11, 0x70, 0x1E, 0x00, 0x00,  // Code for char B
         0x00, 0x00, 0xF0, 0x0F, 0x18, 0x18, 0x08, 0x30, 0x08, 0x20, 0x18, 0x30, 0x70, 0x1E, 0x00, 0x00,  // Code for char C
         0x00, 0x00, 0xF8, 0x3F, 0x08, 0x30, 0x08, 0x30, 0x18, 0x10, 0x30, 0x18, 0xE0, 0x0F, 0x00, 0x00,  // Code for char D
         0x00, 0x00, 0xF8, 0x3F, 0x88, 0x31, 0x88, 0x31, 0x88, 0x31, 0x88, 0x31, 0x88, 0x31, 0x00, 0x00,  // Code for char E
         0x00, 0x00, 0xF8, 0x3F, 0x08, 0x01, 0x08, 0x01, 0x08, 0x01, 0x08, 0x01, 0x08, 0x00, 0x00, 0x00,  // Code for char F
         0x00, 0x00, 0xF0, 0x0F, 0x18, 0x18, 0x08, 0x30, 0x08, 0x23, 0x18, 0x13, 0x70, 0x3F, 0x00, 0x00,  // Code for char G
         0x00, 0x00, 0xF8, 0x3F, 0x80, 0x01, 0x80, 0x01, 0x80, 0x01, 0x80, 0x01, 0xF8, 0x3F, 0x00, 0x00,  // Code for char H
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF8, 0x3F, 0xF8, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  // Code for char I
         0x00, 0x00, 0x00, 0x1C, 0x00, 0x30, 0x00, 0x30, 0x00, 0x30, 0x00, 0x18, 0xF8, 0x0F, 0x00, 0x00,  // Code for char J
         0x00, 0x00, 0xF8, 0x3F, 0x80, 0x01, 0xC0, 0x01, 0x60, 0x07, 0x18, 0x1C, 0x08, 0x30, 0x00, 0x20,  // Code for char K
         0x00, 0x00, 0xF8, 0x3F, 0x00, 0x30, 0x00, 0x30, 0x00, 0x30, 0x00, 0x30, 0x00, 0x30, 0x00, 0x00,  // Code for char L
         0x00, 0x00, 0xF8, 0x3F, 0xF8, 0x01, 0x00, 0x3F, 0x80, 0x1F, 0xF8, 0x00, 0xF8, 0x3F, 0x00, 0x00,  // Code for char M
         0x00, 0x00, 0xF8, 0x3F, 0x70, 0x00, 0xC0, 0x01, 0x00, 0x07, 0x00, 0x3C, 0xF8, 0x3F, 0x00, 0x00,  // Code for char N
         0x80, 0x03, 0xF0, 0x1F, 0x18, 0x10, 0x08, 0x20, 0x08, 0x20, 0x18, 0x18, 0xF0, 0x0F, 0x00, 0x00,  // Code for char O
         0x00, 0x00, 0xF8, 0x3F, 0x08, 0x03, 0x08, 0x03, 0x08, 0x01, 0x18, 0x01, 0xF0, 0x01, 0x00, 0x00,  // Code for char P
         0x80, 0x03, 0xF0, 0x1F, 0x18, 0x10, 0x08, 0x20, 0x08, 0x2C, 0x18, 0x38, 0xF0, 0x2F, 0x00, 0x00,  // Code for char Q
         0x00, 0x00, 0xF8, 0x3F, 0x08, 0x01, 0x08, 0x01, 0x08, 0x07, 0x98, 0x1D, 0xF0, 0x30, 0x00, 0x00,  // Code for char R
         0x00, 0x00, 0x70, 0x1C, 0xD8, 0x30, 0x88, 0x21, 0x08, 0x21, 0x38, 0x33, 0x30, 0x1E, 0x00, 0x00,  // Code for char S
         0x00, 0x00, 0x08, 0x00, 0x08, 0x00, 0xF8, 0x3F, 0xF8, 0x3F, 0x08, 0x00, 0x08, 0x00, 0x00, 0x00,  // Code for char T
         0x00, 0x00, 0xF8, 0x1F, 0x00, 0x30, 0x00, 0x20, 0x00, 0x20, 0x00, 0x30, 0xF8, 0x1F, 0x00, 0x00,  // Code for char U
         0x08, 0x00, 0xF8, 0x00, 0xC0, 0x07, 0x00, 0x3C, 0x00, 0x3E, 0xE0, 0x03, 0x78, 0x00, 0x00, 0x00,  // Code for char V
         0x38, 0x00, 0xF0, 0x3F, 0x00, 0x3F, 0xF8, 0x00, 0xF8, 0x03, 0x00, 0x3C, 0xF8, 0x0F, 0x08, 0x00,  // Code for char W
         0x00, 0x20, 0x18, 0x38, 0x70, 0x0E, 0xC0, 0x03, 0xC0, 0x07, 0x38, 0x1C, 0x08, 0x30, 0x00, 0x00,  // Code for char X
         0x08, 0x00, 0x38, 0x00, 0xE0, 0x00, 0x80, 0x3F, 0xC0, 0x3F, 0x70, 0x00, 0x18, 0x00, 0x00, 0x00,  // Code for char Y
         0x00, 0x00, 0x08, 0x38, 0x08, 0x3E, 0x08, 0x33, 0xC8, 0x30, 0x78, 0x30, 0x18, 0x30, 0x00, 0x00,  // Code for char Z
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFE, 0x7F, 0x02, 0x40, 0x02, 0x40, 0x02, 0x40, 0x00, 0x00,  // Code for char [
         0x00, 0x00, 0x08, 0x00, 0x70, 0x00, 0x80, 0x01, 0x00, 0x0E, 0x00, 0x30, 0x00, 0xC0, 0x00, 0x00,  // Code for char BackSlash
         0x00, 0x00, 0x02, 0x40, 0x02, 0x40, 0x02, 0x40, 0xFE, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  // Code for char ]
         0x00, 0x00, 0x08, 0x00, 0x04, 0x00, 0x02, 0x00, 0x06, 0x00, 0x04, 0x00, 0x08, 0x00, 0x00, 0x00,  // Code for char ^
         0x00, 0x80, 0x00, 0x80, 0x00, 0x80, 0x00, 0x80, 0x00, 0x80, 0x00, 0x80, 0x00, 0x80, 0x00, 0x80,  // Code for char _
         0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x06, 0x00, 0x0C, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  // Code for char `
         0x00, 0x00, 0x00, 0x1D, 0x80, 0x24, 0x80, 0x24, 0x80, 0x32, 0x80, 0x1F, 0x00, 0x3F, 0x00, 0x00,  // Code for char a
         0x00, 0x00, 0xF8, 0x3F, 0x80, 0x10, 0x80, 0x20, 0x80, 0x20, 0x80, 0x19, 0x00, 0x1F, 0x00, 0x00,  // Code for char b
         0x00, 0x00, 0x00, 0x1F, 0x80, 0x30, 0x80, 0x20, 0x80, 0x20, 0x80, 0x11, 0x00, 0x19, 0x00, 0x00,  // Code for char c
         0x00, 0x00, 0x80, 0x1F, 0x80, 0x30, 0x80, 0x20, 0x80, 0x20, 0x80, 0x19, 0xF8, 0x3F, 0x00, 0x00,  // Code for char d
         0x00, 0x00, 0x00, 0x1F, 0x80, 0x12, 0x80, 0x22, 0x80, 0x22, 0x80, 0x33, 0x00, 0x1B, 0x00, 0x00,  // Code for char e
         0x00, 0x00, 0x80, 0x00, 0x80, 0x00, 0xF8, 0x3F, 0x88, 0x00, 0x88, 0x00, 0x88, 0x00, 0x00, 0x00,  // Code for char f
         0x00, 0x00, 0x00, 0xFB, 0x80, 0x94, 0x80, 0x94, 0x80, 0x94, 0x80, 0xB7, 0x80, 0x60, 0x00, 0x00,  // Code for char g
         0x00, 0x00, 0xF8, 0x3F, 0x00, 0x01, 0x80, 0x00, 0x80, 0x00, 0x80, 0x00, 0x80, 0x3F, 0x00, 0x00,  // Code for char h
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x98, 0x3F, 0x88, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  // Code for char i
         0x00, 0x00, 0x00, 0xC0, 0x00, 0x80, 0x00, 0x80, 0x88, 0xFF, 0x98, 0x7F, 0x00, 0x00, 0x00, 0x00,  // Code for char j
         0x00, 0x00, 0xF8, 0x3F, 0x00, 0x06, 0x00, 0x03, 0x80, 0x07, 0x80, 0x18, 0x00, 0x30, 0x00, 0x00,  // Code for char k
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF8, 0x3F, 0xF8, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  // Code for char l
         0x80, 0x3F, 0x80, 0x3F, 0x80, 0x00, 0x80, 0x3F, 0x00, 0x3F, 0x80, 0x00, 0x80, 0x3F, 0x80, 0x3F,  // Code for char m
         0x00, 0x00, 0x80, 0x3F, 0x00, 0x01, 0x80, 0x00, 0x80, 0x00, 0x80, 0x00, 0x80, 0x3F, 0x00, 0x00,  // Code for char n
         0x00, 0x00, 0x00, 0x1F, 0x80, 0x10, 0x80, 0x20, 0x80, 0x20, 0x80, 0x11, 0x00, 0x1F, 0x00, 0x00,  // Code for char o
         0x00, 0x00, 0x80, 0xFF, 0x80, 0x10, 0x80, 0x20, 0x80, 0x20, 0x80, 0x19, 0x00, 0x1F, 0x00, 0x00,  // Code for char p
         0x00, 0x00, 0x80, 0x1F, 0x80, 0x30, 0x80, 0x20, 0x80, 0x20, 0x80, 0x19, 0x80, 0xFF, 0x00, 0x00,  // Code for char q
         0x00, 0x00, 0x00, 0x00, 0x80, 0x3F, 0x00, 0x01, 0x80, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00,  // Code for char r
         0x00, 0x00, 0x00, 0x1B, 0x80, 0x33, 0x80, 0x24, 0x80, 0x24, 0x80, 0x35, 0x00, 0x19, 0x00, 0x00,  // Code for char s
         0x80, 0x00, 0x80, 0x00, 0x80, 0x00, 0xF0, 0x1F, 0x80, 0x20, 0x80, 0x20, 0x00, 0x30, 0x00, 0x00,  // Code for char t
         0x00, 0x00, 0x80, 0x1F, 0x00, 0x30, 0x00, 0x20, 0x00, 0x30, 0x00, 0x18, 0x80, 0x3F, 0x00, 0x00,  // Code for char u
         0x00, 0x00, 0x80, 0x01, 0x00, 0x0F, 0x00, 0x38, 0x00, 0x38, 0x00, 0x07, 0x80, 0x01, 0x00, 0x00,  // Code for char v
         0x80, 0x01, 0x80, 0x1F, 0x00, 0x3C, 0x80, 0x03, 0x80, 0x07, 0x00, 0x38, 0x80, 0x0F, 0x80, 0x00,  // Code for char w
         0x00, 0x00, 0x80, 0x30, 0x80, 0x19, 0x00, 0x0E, 0x00, 0x0F, 0x80, 0x19, 0x00, 0x20, 0x00, 0x00,  // Code for char x
         0x00, 0x00, 0x80, 0x81, 0x00, 0x8F, 0x00, 0xF8, 0x00, 0x38, 0x00, 0x07, 0x80, 0x01, 0x00, 0x00,  // Code for char y
         0x00, 0x00, 0x80, 0x30, 0x80, 0x38, 0x80, 0x24, 0x80, 0x23, 0x80, 0x21, 0x80, 0x20, 0x00, 0x00,  // Code for char z
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xFC, 0x3E, 0x02, 0x40, 0x02, 0x40, 0x00, 0x00,  // Code for char {
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  // Code for char |
         0x02, 0x40, 0x02, 0x40, 0xFC, 0x3E, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  // Code for char }
         0x00, 0x00, 0x06, 0x00, 0x03, 0x00, 0x02, 0x00, 0x04, 0x00, 0x04, 0x00, 0x06, 0x00, 0x00, 0x00,  // Code for char ~
         0xF0, 0x1F, 0x10, 0x10, 0xF0, 0x1F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00   // Code for char 
        };

void IO_Init()
{
	//Set all control pins to be output.
	TCHIPSELECT = 0;
    TRES = 0;
	TDATAMODE = 0;

	CHIPSELECT = 1;

}


void SPI_Init()
{
	//SPI pin mapping.
 	RPOR6bits.RP12R = 8;		//SCK1 >> RP12
	RPOR6bits.RP13R = 7;		//SDO1 >> RP13

	SPI1STATbits.SPISIDL = 1;
	SPI1STATbits.SPIROV = 0;

	SPI1CON1bits.DISSDO = 0;	//SDO1 controlled by SPI module
	SPI1CON1bits.MODE16 = 0;	//byte mode
	SPI1CON1bits.SMP = 0;		//sample data at middle of data output time
	SPI1CON1bits.CKE = 0;		//output data changes from high to low
	SPI1CON1bits.CKP = 0;		//idle > low, active > high
	SPI1CON1bits.MSTEN = 1;		// master mode
	SPI1CON1bits.SPRE2 = 1;		// 8:1 secondary prescaler.
	SPI1CON1bits.SPRE1 = 1;
	SPI1CON1bits.SPRE0 = 0;	
	SPI1CON1bits.PPRE1 = 1;		// 64:1 primary prescaler.
	SPI1CON1bits.PPRE0 = 1;
	
	//The minimun clock cycle for serial interface is 125ns. Here I set it to be 32us.
	//You can speed up the LCD by making the clock cycle shorter.
	
	
	SPI1STATbits.SPIEN = 1;

}


void GLCD_Init()
{	
	IO_Init();
	SPI_Init();
	
	RES = 1;
	RES = 0;					//reset
	__delay_ms(5);
	RES = 1;
	__delay_ms(5);

	GLCD_Command(0b10100010);	// 1/9 bias	
	GLCD_Command(0b10100000);	// ADC = normal
	
	GLCD_Command(0b11001000);	// SHL = reverse 
	GLCD_Command(0b01000000);	// line 0

	GLCD_Command(0b00101100);	// voltage foller off, regulator off, converter on
	__delay_ms(5)
	GLCD_Command(0b00101110);	// voltage foller off, regulator on, converter on
	__delay_ms(5);

	GLCD_Command(0b00101111);	// voltage foller on, regulator on, converter on
	__delay_ms(5);

	GLCD_Command(0b00100110);	// set resistor ratio

	GLCD_Command(0b10000001);	// contrast 50%
	GLCD_Command(0b00011010);	// contrast 50%

	GLCD_Command(0b10101110);	// display off
	GLCD_Command(0b10101111);	// display on
	GLCD_Command(0b10110000);	// page 0 

	GLCD_Command(0b00010000);	// column 0
	GLCD_Command(0b00000000);	// column 0

	GLCD_Command(0b10100100);	// display all pts off
	GLCD_Command(0b11100000);	// turn on column self increment

	GLCD_Clear();
	
}


void GLCD_Out(unsigned char x, unsigned char y,unsigned char * out)
{
	X = x;
	Y = y;

	while(*out != '\0')
	{	
		GLCD_Char(X,Y,*out);
		out++;
		Y++;
		
		if(Y == 16)
		{
			Y = 0;
			X++;
			X&=3;
	
		}

	}

}

void GLCD_SETCURSOR(unsigned char x, unsigned char y)
{
	X = x;
	Y = y;

}


void GLCD_Out_Inc(unsigned char * out)
{

	while(*out != '\0')
	{	
		GLCD_Char(X,Y,*out);
		out++;
		Y++;
		
		if(Y == 16)
		{
			Y = 0;
			X++;
			X&=3;
	
		}

	}

}

void GLCD_Char(unsigned char x,unsigned char y,unsigned char out)		// output a character @ x(row) , y(column) x max = 3, y max = 15
																		// maximun char: 4*16
																		// one char takes 8*16 pixelcs
{

	unsigned char p, c,i;
	X = x;
	Y = y;

	for( c = 0 ; c < 8 ; c++)
	{

		for( p = 0 ; p < 2 ; p ++ ) 
		{
			GLCD_Command(SET_PAGE | ((x<<1) + p));
			GLCD_Command(SET_COLUMN_LOW | (((y<<3) + c) & 0x0F ));
			GLCD_Command(SET_COLUMN_HIGH | (((y<<3)+  c )>> 4));
			GLCD_Data(CHAR_TABLE[(out - 32)*16 + c*2 +  p]);

		}


	}

}

void GLCD_Char_Inc(unsigned char out)
{

	GLCD_Char(X,Y,out);
	Y++;
	
	if(Y == 16)
	{
		Y = 0;
		X++;
		X&=3;

	}
	

}

void GLCD_Sym(unsigned char x,unsigned char y,unsigned char out)		// row X , column Y
{
	X = x;
	Y = y;

	unsigned char p, c,i;
	X = x;
	Y = y;

	for( c = 0 ; c < 8 ; c++)
	{

		for( p = 0 ; p < 2 ; p ++ ) 
		{
			GLCD_Command(SET_PAGE | ((x<<1) + p));
			GLCD_Command(SET_COLUMN_LOW | (((y<<3) + c) & 0x0F ));
			GLCD_Command(SET_COLUMN_HIGH | (((y<<3)+  c )>> 4));
			GLCD_Data(SYMBOLS[out*16 + c*2 +  p]);

		}

	}

}

void GLCD_Sym_Inc(unsigned char out)
{

	GLCD_Sym(X,Y,out);
	Y++;
	
	if(Y == 16)
	{
		Y = 0;
		X++;
		X&=3;

	}
	

}


void GLCD_Data( unsigned char out)
{


	DATAMODE = 1;
	
	//This can be way faster.
	//I set the delay just in case.
	__delay_us(2);
	CHIPSELECT = 0;
		//There should be at least 75ns of delay here. But since I am running at a slow clock, the delay is not necessary.
	SPI_Out(out);
	CHIPSELECT = 1;

}

void GLCD_Command( unsigned char out)
{

	DATAMODE = 0;
	
	//This can be way faster.
	//I set the delay just in case.
	__delay_us(2);

	CHIPSELECT = 0;
	//There should be at least 75ns of delay here. But since I am running at a slow clock, the delay is not necessary.
	SPI_Out(out);
	CHIPSELECT = 1;
}

void GLCD_Clear(void)
{
	unsigned char page,column;

	for( page = 0 ; page < 8 ; page ++ ) 
	{
		GLCD_Command(SET_PAGE | page);
		GLCD_Command(SET_COLUMN_HIGH);
		GLCD_Command(SET_COLUMN_LOW);	
		for( column = 0 ; column < 128 ; column++)
		{
			GLCD_Data(0);
		}

	}
}

void GLCD_Draw_Bitmap(unsigned char *DisplayData)   // DisplayData should be 1024 bytes
{
    unsigned i, j;

    for(i=0;i<8;i++)
        {
        GLCD_Command(0xb0 | i);    // select page 0~7
        GLCD_Command(0x10);        // column 0 
        GLCD_Command(0x00);        // column 0 

        for(j=0;j<128;j++)
        	{
			GLCD_Data(*DisplayData);
			DisplayData++;
            }
        }
}

void GLCD_ClearRow(unsigned char x)
{
	GLCD_Out(x,0,"                ");
}

void SPI_Out( unsigned char out )
{
	unsigned char temp = 0;

	IFS0bits.SPI1IF = 0;
	SPI1BUF = out;
	while ( !IFS0bits.SPI1IF  ) ;
	temp = SPI1BUF;

				
}